# Arduino Programming with MATLAB
## A Comprehensive Lecture

---

## Table of Contents
1. [Introduction and Overview](#introduction-and-overview)
2. [Prerequisites and Setup](#prerequisites-and-setup)
3. [MATLAB Support Package for Arduino](#matlab-support-package-for-arduino)
4. [Basic Connection and Communication](#basic-connection-and-communication)
5. [Digital I/O Operations](#digital-io-operations)
6. [Analog Operations](#analog-operations)
7. [Serial Communication](#serial-communication)
8. [Sensor Integration Examples](#sensor-integration-examples)
9. [Advanced Topics](#advanced-topics)
10. [Best Practices and Troubleshooting](#best-practices-and-troubleshooting)

---

## 1. Introduction and Overview

### What is Arduino-MATLAB Integration?

Arduino-MATLAB integration allows you to control Arduino hardware directly from MATLAB environment, combining:
- **Arduino's** real-time hardware control capabilities
- **MATLAB's** powerful computational and visualization tools

### Key Benefits

- **Rapid Prototyping**: Quick testing of algorithms with real hardware
- **Data Analysis**: Leverage MATLAB's extensive analysis toolbox
- **Visualization**: Real-time plotting and data visualization
- **Algorithm Development**: Test control algorithms before deployment
- **Educational**: Excellent for teaching embedded systems concepts

### Applications

- Data acquisition systems
- Control system prototyping
- Sensor networks
- IoT applications
- Educational projects
- Research and development

---

## 2. Prerequisites and Setup

### Hardware Requirements

- Arduino board (Uno, Mega, Nano, etc.)
- USB cable for connection
- Sensors/actuators as needed
- Breadboard and jumper wires

### Software Requirements

- MATLAB R2014a or later
- Arduino IDE (for initial board setup)
- MATLAB Support Package for Arduino Hardware

### Installation Steps

1. **Install Arduino IDE**
   ```
   Download from: https://www.arduino.cc/en/software
   ```

2. **Install MATLAB Support Package**
   ```matlab
   % In MATLAB Command Window
   arduinosetup
   ```
   Or use Add-On Explorer: Home → Add-Ons → Get Add-Ons

3. **Verify Installation**
   ```matlab
   % Check available Arduino boards
   listArduinoLibraries
   ```

---

## 3. MATLAB Support Package for Arduino

### Key Features

- Direct hardware control from MATLAB
- Real-time data acquisition
- Support for multiple Arduino models
- Built-in sensor libraries
- No need to write Arduino sketches for basic operations

### Supported Arduino Boards

- Arduino Uno
- Arduino Mega 2560
- Arduino Nano
- Arduino Leonardo
- Arduino Micro

### Communication Methods

1. **USB Serial Communication** (Primary method)
2. **Wireless Communication** (WiFi/Bluetooth modules)
3. **Ethernet Communication** (Ethernet shield)

---

## 4. Basic Connection and Communication

### Establishing Connection

```matlab
% Create Arduino object
a = arduino();  % Auto-detect port and board

% Or specify explicitly
a = arduino('COM3', 'Uno');  % Windows
a = arduino('/dev/ttyUSB0', 'Uno');  % Linux

% Check connection
disp(a)
```

### Board Information

```matlab
% Get board information
boardInfo = a.Board
availablePins = a.AvailablePins
portInfo = a.Port

% Check pin capabilities
pinInfo = configurePin(a, 'D13', 'DigitalOutput')
```

### Closing Connection

```matlab
% Always close connection when done
clear a
% or
delete(a)
```

---

## 5. Digital I/O Operations

### Digital Output

```matlab
% Configure pin as digital output
configurePin(a, 'D13', 'DigitalOutput');

% Write digital values
writeDigitalPin(a, 'D13', 1);  % HIGH (5V)
pause(1);
writeDigitalPin(a, 'D13', 0);  % LOW (0V)
```

### Digital Input

```matlab
% Configure pin as digital input
configurePin(a, 'D2', 'DigitalInput');

% Read digital value
buttonState = readDigitalPin(a, 'D2');
disp(['Button state: ' num2str(buttonState)]);
```

### LED Blinking Example

```matlab
% Connect LED to pin 13 with 220Ω resistor
a = arduino();
configurePin(a, 'D13', 'DigitalOutput');

% Blink LED 10 times
for i = 1:10
    writeDigitalPin(a, 'D13', 1);
    pause(0.5);
    writeDigitalPin(a, 'D13', 0);
    pause(0.5);
end

clear a;
```

---

## 6. Analog Operations

### Analog Input (ADC)

```matlab
% Arduino Uno has 6 analog pins (A0-A5)
% 10-bit resolution (0-1023) representing 0-5V

% Read analog voltage
voltage = readVoltage(a, 'A0');
disp(['Voltage: ' num2str(voltage) 'V']);

% Read raw ADC value
rawValue = readVoltage(a, 'A0') * 1023 / 5;
```

### Analog Output (PWM)

```matlab
% Configure pin for PWM output
configurePin(a, 'D9', 'PWM');

% Write PWM value (0-1 range)
writePWMVoltage(a, 'D9', 2.5);  % 50% duty cycle

% Or use duty cycle directly
writePWMDutyCycle(a, 'D9', 0.75);  % 75% duty cycle
```

### Potentiometer Reading Example

```matlab
a = arduino();

% Real-time potentiometer reading
figure;
for i = 1:100
    voltage = readVoltage(a, 'A0');
    plot(i, voltage, 'ro');
    hold on;
    xlabel('Sample');
    ylabel('Voltage (V)');
    title('Real-time Potentiometer Reading');
    drawnow;
    pause(0.1);
end

clear a;
```

---

## 7. Serial Communication

### Basic Serial Communication

```matlab
% Arduino object automatically handles serial communication
% Default baud rate: 9600

% Send data to Arduino (for custom sketches)
writeSerial(a, [65 66 67]);  % Send bytes

% Read data from Arduino
data = readSerial(a, 10, 'uint8');  % Read 10 bytes
```

### Advanced Serial Example

```matlab
% Custom Arduino sketch for sensor data
% Arduino code would continuously send sensor data

a = arduino();
figure;
data = [];

for i = 1:50
    % Read sensor data (assuming Arduino sends formatted data)
    if a.AvailableSerial > 0
        newData = readSerial(a, a.AvailableSerial, 'uint8');
        data = [data; double(newData)];
        
        plot(data);
        title('Real-time Sensor Data');
        xlabel('Sample');
        ylabel('Value');
        drawnow;
    end
    pause(0.1);
end

clear a;
```

---

## 8. Sensor Integration Examples

### Temperature Sensor (LM35)

```matlab
function temperature = readLM35(arduino_obj, pin)
    % LM35 outputs 10mV per degree Celsius
    voltage = readVoltage(arduino_obj, pin);
    temperature = voltage * 100;  % Convert to Celsius
end

% Usage example
a = arduino();
temp = readLM35(a, 'A0');
disp(['Temperature: ' num2str(temp) '°C']);
```

### Ultrasonic Sensor (HC-SR04)

```matlab
function distance = readUltrasonic(arduino_obj, trigPin, echoPin)
    % Configure pins
    configurePin(arduino_obj, trigPin, 'DigitalOutput');
    configurePin(arduino_obj, echoPin, 'DigitalInput');
    
    % Send trigger pulse
    writeDigitalPin(arduino_obj, trigPin, 0);
    pause(0.000002);
    writeDigitalPin(arduino_obj, trigPin, 1);
    pause(0.00001);
    writeDigitalPin(arduino_obj, trigPin, 0);
    
    % Measure echo duration (simplified)
    % Note: Accurate timing requires custom Arduino sketch
    distance = 20;  % Placeholder - requires timing measurement
end
```

### Light Sensor (Photoresistor)

```matlab
a = arduino();

% Create real-time light monitoring
figure;
subplot(2,1,1);
lightData = [];
times = [];

for i = 1:100
    % Read light sensor (voltage divider circuit)
    lightLevel = readVoltage(a, 'A1');
    lightData = [lightData; lightLevel];
    times = [times; datetime('now')];
    
    % Plot data
    subplot(2,1,1);
    plot(times, lightData, 'b-');
    title('Light Level Monitoring');
    ylabel('Voltage (V)');
    
    % Control LED based on light level
    if lightLevel < 2.5  % Dark threshold
        writeDigitalPin(a, 'D13', 1);  % Turn on LED
        status = 'LED ON';
    else
        writeDigitalPin(a, 'D13', 0);  % Turn off LED
        status = 'LED OFF';
    end
    
    subplot(2,1,2);
    text(0.5, 0.5, status, 'HorizontalAlignment', 'center');
    axis off;
    
    drawnow;
    pause(0.2);
end

clear a;
```

---

## 9. Advanced Topics

### Servo Motor Control

```matlab
% Servo control requires PWM
a = arduino();
configurePin(a, 'D9', 'Servo');

% Move servo to different positions
positions = [0, 90, 180, 90, 0];  % Degrees

for pos = positions
    writePosition(a, 'D9', pos);
    pause(1);
end

clear a;
```

### I2C Communication

```matlab
% Example with I2C device (e.g., accelerometer)
a = arduino();

% Scan for I2C devices
addrs = scanI2CBus(a);
disp('I2C devices found at addresses:');
disp(dec2hex(addrs));

% Read from I2C device (example)
% deviceAddr = 0x53;  % Device address
% data = readI2C(a, deviceAddr, 6);  % Read 6 bytes
```

### Multiple Sensor Data Logging

```matlab
function dataLogger(duration_minutes)
    a = arduino();
    
    % Setup
    configurePin(a, 'D13', 'DigitalOutput');  % Status LED
    
    % Data storage
    timestamps = [];
    temperature_data = [];
    light_data = [];
    
    % Logging parameters
    sample_rate = 1;  % Samples per second
    total_samples = duration_minutes * 60 * sample_rate;
    
    fprintf('Starting data logging for %d minutes...\n', duration_minutes);
    
    for i = 1:total_samples
        % Timestamp
        current_time = datetime('now');
        timestamps = [timestamps; current_time];
        
        % Read sensors
        temp = readVoltage(a, 'A0') * 100;  % LM35 temperature
        light = readVoltage(a, 'A1');       % Light sensor
        
        % Store data
        temperature_data = [temperature_data; temp];
        light_data = [light_data; light];
        
        % Status indication
        if mod(i, 10) == 0
            writeDigitalPin(a, 'D13', 1);
            pause(0.1);
            writeDigitalPin(a, 'D13', 0);
        end
        
        % Progress indicator
        if mod(i, 60) == 0
            fprintf('Logged %d samples (%.1f minutes)\n', i, i/(60*sample_rate));
        end
        
        pause(1/sample_rate);
    end
    
    % Save data
    data_table = table(timestamps, temperature_data, light_data, ...
                      'VariableNames', {'Time', 'Temperature_C', 'Light_V'});
    writetable(data_table, 'sensor_data.csv');
    
    % Plot results
    figure;
    subplot(2,1,1);
    plot(timestamps, temperature_data);
    title('Temperature vs Time');
    ylabel('Temperature (°C)');
    
    subplot(2,1,2);
    plot(timestamps, light_data);
    title('Light Level vs Time');
    ylabel('Voltage (V)');
    xlabel('Time');
    
    clear a;
    fprintf('Data logging complete. Data saved to sensor_data.csv\n');
end
```

---

## 10. Best Practices and Troubleshooting

### Best Practices

1. **Always Clear Objects**
   ```matlab
   % Always close Arduino connection
   clear a;
   ```

2. **Error Handling**
   ```matlab
   try
       a = arduino();
       % Your code here
   catch ME
       fprintf('Error: %s\n', ME.message);
   end
   clear a;
   ```

3. **Pin Configuration**
   ```matlab
   % Always configure pins before use
   configurePin(a, 'D13', 'DigitalOutput');
   ```

4. **Timing Considerations**
   ```matlab
   % Add appropriate delays
   pause(0.001);  % Minimum delay for stable operation
   ```

### Common Issues and Solutions

#### Connection Problems
```matlab
% Check available ports
serialportlist

% Specify port explicitly
a = arduino('COM3', 'Uno');
```

#### Pin Configuration Errors
```matlab
% Reset pin configuration
configurePin(a, 'D13', 'Unset');
configurePin(a, 'D13', 'DigitalOutput');
```

#### Memory Issues
```matlab
% Clear variables regularly in loops
clear temp_data;
```

### Performance Optimization

1. **Minimize MATLAB-Arduino Communication**
   - Batch operations when possible
   - Use appropriate sample rates

2. **Efficient Data Handling**
   ```matlab
   % Pre-allocate arrays
   data = zeros(1000, 1);
   
   % Use circular buffers for continuous data
   buffer_size = 100;
   data_buffer = zeros(buffer_size, 1);
   ```

### Debugging Tips

1. **Check Hardware Connections**
2. **Verify Pin Numbers and Types**
3. **Monitor Serial Communication**
4. **Use Try-Catch Blocks**
5. **Test with Simple Examples First**

---

## Sample Complete Project: Environmental Monitor

```matlab
function environmentalMonitor()
    % Complete environmental monitoring system
    
    try
        % Initialize Arduino
        a = arduino();
        fprintf('Arduino connected successfully\n');
        
        % Configure pins
        configurePin(a, 'D13', 'DigitalOutput');  % Status LED
        configurePin(a, 'D12', 'DigitalOutput');  % Alarm LED
        
        % Setup real-time plot
        figure('Name', 'Environmental Monitor');
        subplot(2,1,1);
        h_temp = animatedline('Color', 'r', 'LineWidth', 2);
        ylabel('Temperature (°C)');
        title('Temperature Monitoring');
        grid on;
        
        subplot(2,1,2);
        h_light = animatedline('Color', 'b', 'LineWidth', 2);
        ylabel('Light Level (V)');
        xlabel('Time (s)');
        title('Light Level Monitoring');
        grid on;
        
        % Monitoring loop
        start_time = tic;
        sample_count = 0;
        
        while sample_count < 200  % Run for ~200 samples
            current_time = toc(start_time);
            sample_count = sample_count + 1;
            
            % Read sensors
            temp_voltage = readVoltage(a, 'A0');
            temperature = temp_voltage * 100;  % LM35 conversion
            light_level = readVoltage(a, 'A1');
            
            % Update plots
            addpoints(h_temp, current_time, temperature);
            addpoints(h_light, current_time, light_level);
            
            % Status LED blink
            if mod(sample_count, 10) == 0
                writeDigitalPin(a, 'D13', 1);
                pause(0.05);
                writeDigitalPin(a, 'D13', 0);
            end
            
            % Temperature alarm
            if temperature > 30  % Threshold
                writeDigitalPin(a, 'D12', 1);  % Alarm on
            else
                writeDigitalPin(a, 'D12', 0);  % Alarm off
            end
            
            % Update display
            drawnow limitrate;
            
            % Status update
            if mod(sample_count, 20) == 0
                fprintf('Sample %d: Temp=%.1f°C, Light=%.2fV\n', ...
                       sample_count, temperature, light_level);
            end
            
            pause(0.5);  % Sample every 0.5 seconds
        end
        
        fprintf('Monitoring complete\n');
        
    catch ME
        fprintf('Error occurred: %s\n', ME.message);
    end
    
    % Cleanup
    try
        writeDigitalPin(a, 'D13', 0);  % Turn off LEDs
        writeDigitalPin(a, 'D12', 0);
        clear a;
    catch
        % Silent cleanup
    end
end
```

---

## Laboratory Exercises

### Exercise 1: Traffic Light Simulator
Create a traffic light system using 3 LEDs (Red, Yellow, Green) with realistic timing.

### Exercise 2: Temperature Data Logger
Build a system that logs temperature data to a file and creates statistical analysis.

### Exercise 3: Light-Following Robot Control
Use light sensors to control motor directions (simulation with LEDs).

### Exercise 4: Home Automation Simulator
Create a system that monitors multiple sensors and controls multiple outputs based on conditions.

---

## Conclusion

Arduino-MATLAB integration provides a powerful platform for:
- Rapid prototyping of embedded systems
- Real-time data acquisition and analysis
- Educational demonstrations
- Research and development projects

### Next Steps
- Explore specialized sensor libraries
- Learn about Simulink integration
- Investigate wireless communication options
- Study advanced control algorithms

### Additional Resources
- MATLAB Arduino Documentation
- Arduino Reference Guide
- Sensor interfacing tutorials
- Control systems with Arduino

---

## Assignment Suggestions

1. **Basic**: Create a digital thermometer with LED status indicators
2. **Intermediate**: Build a data acquisition system for multiple sensors
3. **Advanced**: Implement a PID controller for motor speed control
4. **Project**: Design a complete environmental monitoring station

Remember: Always prioritize safety when working with electrical components and follow proper wiring practices!